# vim 食用记录

## vim 的哲学

```sh
执行次数 + 操作 + 范围
次数 1,2,3
操作 v d y c
范围 a i w p $ " ' { ( [ t

 ni hao tang jun xin
 $('nihao')
 <a href="xx" >kjkjk </a>
```

## vim 常用模式

- normal 模式

- insert 模式

- visual 模式

```
v       " 选中当前字符，并进入 visual 模式，随着光标的游走来选中字符
V       " 选中当前行，并进入 visual 模式，随着光标的上下移动整行选中字符
<c-v>   " 选中当前字符，并进去 visual 模式，随着光标的移动以长方形的模式选中字符
```

- command 模式: 命令行模式，该模式下可以执行保存推出、分割窗口、插件管理等命令。

- replace 模式: replace 模式的使用频率相对较少，主要在替换单个或连续多个字符时使用。
  - 将光标移动到想要替换的字符上，按下 r 进入 replace 模式，然后按下按下任意字符，此时你会看到字符已经替换成功，并且自动返回 normal 模式。
  - 如果你想要连续替换多个字符，需要使用 R，比如有一个单词 code，我们将光标移动到 c 上，然后按下 R，随后键入 name，你会发现整个单词被替换过来，并且现在仍然停留在 replace 模式下，需要按下 `<esc>` 才会返回 normal 模式


## 写入、保存、退出

```
:q[uit]                 " 退出
:q!                     " 强制退出
:w[rite]                " 保存
:w!                     " 强制保存，能不能保存成功取决于用户对文件的权限
:w ! sudo tee %         " 如果没有权限保存，试试这个命令
ZZ                      " 两个大写的 Z，没有修改直接退出，有修改保存后退出
:e!                     " 放弃所有修改，从上次保存文件开始再编辑命令历史

:w newfilename          " 另存为新文件
:1, 10 w newfilename    " 将 1 到 10 行的内容另存为新文件
:1, 10 w >> filename    " 将 1 到 10 行的内容另存为新文件
:r filename             " 将目标文件的内容追加到当前光标下一行
:3 r filename           " 将目标文件的内容追加到第 3 行一下

:! ls                   " 暂时离开 Vim 查看当前目录的文件，回车后返回 Vim
```

## vim 移动

在 Vim 中光标操作基本都是在 normal 模式下完成的，如果你有时候搞不清，那就多按几次 `<esc>` 键

### 基本移动

- 上下左右

```
h           " 方向键 ←
j           " 方向键 ↓
k           " 方向键 ↑
l           " 方向键 →
```

另外借助数字键可以更快的做到光标跳转，5l 表示向右移动 5 个字符，5j 表示向下移动 5 行，其他依次类推


### 行内移动

- 单词移动

```
w   " 移动到下一个单词的第一个位置
e   " 移动到下一个单词的末尾
b   " 移动到上一个单词的第一个位置
ge  " 移动到上一个单词的末尾
```

w 前面可以加上数字，表示 w 命令重复几次，比如3w 等同于按下三次w

大写的 W / E / B / gE 表示只使用空格作为分隔

- 行首行尾

```
$  " 移动到行的末尾
0  " 移动到行的开头
^  " 移动到第一个非空白字符
g_ " 移动到最后一个非空白字符
```

- 行内移动到特定字符

```
f+字符  " 移动到行内当前光标后面的第一个这个字符
t+字符  " 移动到行内当前光标后的的第一个这个字符的前一个位置
F+字符  " 【f+字符】的反向
t+字符  " 【t+字符】的反向
```

### 行间移动

- 翻页

```
<c-f>   " 向下移动一页
<c-d>   " 向下移动半页
<c-e>   " 整体向下移动一行
<c-b>   " 向上移动一页
<c-u>   " 向上移动半页
<c-y>   " 整体向上移动一行
```

- 重画

```
z<CR>   " z<CR> 或 zt  重画，当前行置于窗口顶端
z.      " z.    或 zz  重画，当前行置于窗口正中
z-      " z-    或 zb  重画，当前行置于窗口底端
```

- 指定行移动

```
数字+G/gg   " 移动到文件的特定行
:数字<CR>   " 移动到最后一个非空白字符
```

- 页头页尾

```
gg          " 移动到第一行
G           " 移动到最后一行"
```

### 括号匹配移动

```
%      " 找到当前光标下或者之后的第一个括号，并移动到它匹配的括号的位置
[[     " 到函数头
]]     " 到函数尾
[{     " 到块开始位置
]}     " 到块结束位置
```

> 括号包括：
> 
> - ([{}])
> - /* */
> - #if, #ifdef, #else, #elif, #endif

### 导航

`Ctrl-o`（表示为 C-o）和 `Ctrl-i`（表示为 C-i）是两个导航命令，它们可以让你在跳转历史中前后移动。

- Ctrl-o：向后移动到较旧的跳转位置。例如，如果你从行 1 跳转到行 50，然后按 Ctrl-o，你的光标将回到行 1。

- Ctrl-i：向前移动到较新的跳转位置。在上面的例子中，如果你在行 1 按 Ctrl-o 回到行 1，然后按 Ctrl-i，你的光标将回到行 50。

这两个命令可以让你在编辑文件时快速地在不同的位置之间跳转，特别是在查看和编辑大文件时非常有用。

## 查找和替换

查找

```
/word   " 从光标位置向下搜索 word 单词
?word   " 从光标位置向上搜索 word 单词
*       " 搜索光标下单词
n       " 英文字母 n，根据 / 或 ? 搜索的方向定位到下一个匹配目标
N       " 与 n 相反，定位匹配目标
```

大小写相关

```
:set ignorecase     " 搜索中忽略大小写
:set smartcase      " 搜索中忽略大小写，除非搜索词中存在大小写字母
```

替换命令的一般形式如下：

`:[range]s/{pattern}/{string}/[flags] [count]`

该命令在[range]中的每一行中搜索{pattern}，并将其替换为{string}。是与命令[count]相乘的正整数。

如果未给出[range]和[count]，则仅替换当前行中找到的pattern。当前行是光标所在的行。

```
:s/foo/bar/             " 在当前行中搜索字符串 foo 的第一个匹配项，并将其替换为 bar
:s/foo/bar/g            " 要替换当前行中所有出现的搜索模式，请添加 g 标志
                        " 要忽略搜索模式的大小写，请使用i 标志：
:%s/foo/bar/g           " 如果要搜索并替换整个文件中的所有匹配的模式，请使用百分比字符%作为range。此字符表示从文件的第一行到最后一行的范围
:s/foo//g               " 如果省略{string}部分，则将其视为空字符串，并删除匹配的模式,删除当前行中字符串 foo 的所有匹配

" 你还可以使用正则表达式作为搜索模式。下面的命令将所有以 foo开头的行替换为 Vim is the best：
:%s/^foo.*/Vim is the best/gc
```

```
" range 也可这样使用
:n1,n2s/word1/word2/g   " n1, n2 表示数字，替换 n1 行到 n2 行的单词
:1,$s/word1/word2/g     " 全文替换，也可以写成 :%s/word1/word2/g
:1,$s/word1/word2/gc    " 全文替换，并出现确认提示
```

## 替换（与上述替换有所不同，基于 replace 模式）

```
r   " 替换单个字符，自动返回 normal 模式
R   " 连续替换多个字符，手动 <esc> 返回 normal 模式
```

## 复制、粘贴和删除

```
x           " 向后删除一个字符
nx          " 向后删除 n 个字符
X           " 向前删除一个字符
nX          " 向前删除 n 个字符

dd          " 删除当前行
ndd         " 向下删除 n 行
d1G / dgg   " 删除第一行到当前行的数据
dG          " 删除当前行到最后一行的数据
d$          " 删除当前字符到行尾
D           " 删除当前字符到行尾
d0          " 从行首删除到当前字符

yy          " 复制当前行
Y           " 复制当前行
nyy         " 从当前行开始复制 n 行
y1G / ygg   " 从第一行复制到当前行
yG          " 从当前行复制到最后一行
y0          " 从行首复制到当前字符
y$          " 从当前字符复制到行尾

p, P        " 黏贴，p 黏贴到光标下一行，P 黏贴到光标上一行
yyp         " 复制并粘贴
ddp         " 删除并粘贴，相当于下移当前行


"+y         " 复制本文到系统剪切板
"+p         " 粘贴系统剪切板到 Vim（不会影响文本格式）
```

## 插入

```
i   " 在光标前进入 insert 模式
I   " 在当前行左边第一个非空字符前进入 insert 模式，类似其他编辑器的 <c-a> 快捷键
a   " 在光标后进入 insert 模式
A   " 在当前行右边第一个非空字符前进入 insert 模式，类似其他编辑器的 <c-e> 快捷键
o   " 在光标的下一行插入
O   " 在光标的上一行插入
s   " 删除当前字符，并进入 insert 模式
S   " 删除当前行，并进入插入模式

vc  " 删除当前字符，并进入 insert 模式
cc  " 删除当前行，并进入插入模式
c0  " 删除光标位置到行首，并进入 insert 模式
cg_ " 删除光标位置到行尾最后一个非空字符，并进入 insert 模式
ce  " 删除光标位置到单词末尾，并进入 insert 模式
cw  " 删除光标位置到单词末尾，并进入 insert 模式
ciw " 删除当前单词，并进入 insert 模式
cip " 删除整个段落，并进入 insert 模式
ci( " 删除当前括号内的内容，并进入 insert 模式 适用于 ([{<'` 等所有成对的标签
```

## 撤销和重做

```
u       " 撤销
<c-r>   " 重做
.       " 重复完成操作
```

## 大小写

```
~       " 当前字符大小写反转
G~~     " 整行字符大小写反转
vu      " 当前字符小写
vU      " 当前字符大写
viwu    " 当前单词字符小写
viwU    " 当前单词字符大写
ggguG   " 文本所有字符小写
gggUG   " 文本所有字符大写

" 使用替换
:%s/\<./\u&/g       " 将所有单词首字母大写（需要使用 :nohls 去掉高亮）
:%s/\<./\l&/g       " 将所有单词首字母小写
:%s/.*/\u&          " 将每行第一个字母大写
:%s/.*/\l&          " 将每行第一个字母小写
```

